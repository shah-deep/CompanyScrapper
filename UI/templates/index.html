<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Crawler & Scrapper</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1f77b4;
            --secondary-color: #2c3e50;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-bg: #343a40;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 1400px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
        }

        .header p {
            font-size: 1.1rem;
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
        }

        .nav-tabs {
            border-bottom: 2px solid var(--light-bg);
            background: var(--light-bg);
        }

        .nav-tabs .nav-link {
            border: none;
            border-radius: 0;
            color: var(--secondary-color);
            font-weight: 600;
            padding: 1rem 2rem;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            background: white;
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .nav-tabs .nav-link:hover {
            background: rgba(255,255,255,0.8);
            color: var(--primary-color);
        }

        .tab-content {
            padding: 2rem;
        }

        .form-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .form-label {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(31, 119, 180, 0.25);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 10px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary:disabled {
            background: #6c757d;
            transform: none;
            box-shadow: none;
        }

        .progress-container {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .progress {
            height: 8px;
            border-radius: 5px;
            background: #e9ecef;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--primary-color), var(--info-color));
            border-radius: 5px;
        }

        .status-message {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            font-weight: 600;
        }

        .status-success {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .status-error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        .status-info {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info-color);
            border: 1px solid rgba(23, 162, 184, 0.3);
        }

        .results-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .metric-card {
            background: linear-gradient(135deg, var(--primary-color), var(--info-color));
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .file-content {
            background: var(--light-bg);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .json-viewer {
            background: var(--light-bg);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .expandable-content.expanded {
            max-height: 500px;
        }

        .footer {
            background: var(--dark-bg);
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tab-content {
                padding: 1rem;
            }
            
            .form-section {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-building"></i> Company Crawler & Scrapper</h1>
            <p>Discover and extract knowledge from company websites</p>
        </div>

        <!-- Navigation -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="crawler-tab" data-bs-toggle="tab" data-bs-target="#crawler" type="button" role="tab">
                    <i class="fas fa-spider"></i> Crawler
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="scrapper-tab" data-bs-toggle="tab" data-bs-target="#scrapper" type="button" role="tab">
                    <i class="fas fa-file-alt"></i> Scrapper
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab">
                    <i class="fas fa-database"></i> Check Data
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabsContent">
            <!-- Crawler Tab -->
            <div class="tab-pane fade show active" id="crawler" role="tabpanel">
                <div class="form-section">
                    <h3><i class="fas fa-spider"></i> Company Crawler</h3>
                    <p class="text-muted">Discover URLs from company websites and external sources</p>
                    
                    <form id="crawlerForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="companyUrl" class="form-label">Company Homepage URL *</label>
                                    <input type="url" class="form-control" id="companyUrl" placeholder="https://example.com" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="teamId" class="form-label">Team ID *</label>
                                    <input type="text" class="form-control" id="teamId" placeholder="team_001" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="skipWords" class="form-label">Skip Words (one per line)</label>
                                    <textarea class="form-control" id="skipWords" rows="3" placeholder="reddit&#10;login&#10;terms"></textarea>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="additionalUrls" class="form-label">Additional URLs</label>
                                    <textarea class="form-control" id="additionalUrls" rows="3" placeholder="URLs starting with https:// or http://"></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="maxPages" class="form-label">Maximum Pages to Crawl</label>
                                    <input type="number" class="form-control" id="maxPages" value="20" min="1" max="1000">
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="skipExternal">
                                        <label class="form-check-label" for="skipExternal">
                                            Skip External URL Search
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary" id="startCrawlBtn">
                                <i class="fas fa-rocket"></i> Start Crawling
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Progress Section -->
                <div id="crawlerProgress" class="progress-container" style="display: none;">
                    <h5><i class="fas fa-cog fa-spin"></i> Crawling in Progress</h5>
                    <div class="progress mb-3">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div id="crawlerStatus" class="status-message status-info">
                        Initializing...
                    </div>
                </div>

                <!-- Results Section -->
                <div id="crawlerResults" class="results-section" style="display: none;">
                    <h4><i class="fas fa-chart-bar"></i> Crawling Results</h4>
                    <div id="crawlerMetrics" class="row"></div>
                    
                    <div class="mt-4">
                        <h5><i class="fas fa-file-alt"></i> Generated URL File</h5>
                        <div id="urlFileContent" class="file-content"></div>
                        <div class="mt-3">
                            <button class="btn btn-outline-primary" id="downloadUrlsBtn">
                                <i class="fas fa-download"></i> Download URLs
                            </button>
                            <button class="btn btn-outline-secondary" id="refreshUrlsBtn">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scrapper Tab -->
            <div class="tab-pane fade" id="scrapper" role="tabpanel">
                <div class="form-section">
                    <h3><i class="fas fa-file-alt"></i> Knowledge Scrapper</h3>
                    <p class="text-muted">Extract and process knowledge from discovered URLs</p>
                    
                    <form id="scrapperForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="scrapeTeamId" class="form-label">Team ID *</label>
                                    <input type="text" class="form-control" id="scrapeTeamId" placeholder="team_001" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="userId" class="form-label">User ID (Optional)</label>
                                    <input type="text" class="form-control" id="userId" placeholder="user_001">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="processingMode" class="form-label">Processing Mode</label>
                                    <select class="form-select" id="processingMode">
                                        <option value="multiprocessing">Multiprocessing</option>
                                        <option value="async">Async</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="scrapeAdditionalUrls" class="form-label">Additional URLs</label>
                                    <textarea class="form-control" id="scrapeAdditionalUrls" rows="3" placeholder="URLs starting with https:// or http://"></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="skipExistingUrls" checked>
                                        <label class="form-check-label" for="skipExistingUrls">
                                            Skip Existing URLs in DB
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="iterative" checked>
                                        <label class="form-check-label" for="iterative">
                                            Iterative Subpage Discovery
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary" id="startScrapeBtn">
                                <i class="fas fa-rocket"></i> Start Scraping
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Progress Section -->
                <div id="scrapeProgress" class="progress-container" style="display: none;">
                    <h5><i class="fas fa-cog fa-spin"></i> Scraping in Progress</h5>
                    <div class="progress mb-3">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div id="scrapeStatus" class="status-message status-info">
                        Initializing...
                    </div>
                </div>

                <!-- Results Section -->
                <div id="scrapeResults" class="results-section" style="display: none;">
                    <h4><i class="fas fa-chart-bar"></i> Scraping Results</h4>
                    <div id="scrapeMetrics" class="row"></div>
                </div>
            </div>

            <!-- Data Tab -->
            <div class="tab-pane fade" id="data" role="tabpanel">
                <div class="form-section">
                    <h3><i class="fas fa-database"></i> Check Data</h3>
                    <p class="text-muted">View and download crawled URLs and scraped knowledge</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="dataTeamId" class="form-label">Team ID *</label>
                                <input type="text" class="form-control" id="dataTeamId" placeholder="team_001" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-primary w-100" id="getUrlsBtn">
                                <i class="fas fa-file-alt"></i> Get URLs
                            </button>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-primary w-100" id="getDataBtn">
                                <i class="fas fa-database"></i> Fetch Scrapped Data
                            </button>
                        </div>
                    </div>
                </div>

                <!-- URLs Section -->
                <div id="urlsSection" class="results-section" style="display: none;">
                    <h4><i class="fas fa-file-alt"></i> URL File Contents</h4>
                    <div id="urlsContent" class="file-content"></div>
                    <div class="mt-3">
                        <button class="btn btn-outline-primary" id="downloadUrlsDataBtn">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                </div>

                <!-- Data Section -->
                <div id="dataSection" class="results-section" style="display: none;">
                    <h4><i class="fas fa-database"></i> Scraped Knowledge Data</h4>
                    <div id="dataContent" class="json-viewer"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>&copy; 2024 Company Crawler & Scrapper. Built with Flask and Bootstrap.</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentTaskId = null;
        let taskCheckInterval = null;

        // Utility functions
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.tab-content').insertBefore(alertDiv, document.querySelector('.form-section'));
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        function updateProgress(progressElement, statusElement, progress, status, type = 'info') {
            if (progressElement) {
                progressElement.style.width = progress + '%';
            }
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.className = `status-message status-${type}`;
            }
        }

        function checkTaskStatus(taskId, progressContainer, progressBar, statusElement, onComplete) {
            fetch(`/api/task/${taskId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'running') {
                        updateProgress(progressBar, statusElement, 50, data.progress, 'info');
                    } else if (data.status === 'completed') {
                        updateProgress(progressBar, statusElement, 100, data.progress, 'success');
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                            if (onComplete) onComplete(data.result);
                        }, 2000);
                        if (taskCheckInterval) {
                            clearInterval(taskCheckInterval);
                            taskCheckInterval = null;
                        }
                    } else if (data.status === 'failed') {
                        updateProgress(progressBar, statusElement, 100, data.progress, 'error');
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                        }, 3000);
                        if (taskCheckInterval) {
                            clearInterval(taskCheckInterval);
                            taskCheckInterval = null;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error checking task status:', error);
                    updateProgress(progressBar, statusElement, 100, 'Error checking status', 'error');
                });
        }

        // Crawler form submission
        document.getElementById('crawlerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                company_url: document.getElementById('companyUrl').value,
                team_id: document.getElementById('teamId').value,
                additional_input: document.getElementById('additionalUrls').value,
                skip_words: document.getElementById('skipWords').value,
                max_pages: parseInt(document.getElementById('maxPages').value),
                skip_external: document.getElementById('skipExternal').checked
            };

            fetch('/api/crawl', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentTaskId = data.task_id;
                    document.getElementById('crawlerProgress').style.display = 'block';
                    document.getElementById('startCrawlBtn').disabled = true;
                    
                    taskCheckInterval = setInterval(() => {
                        checkTaskStatus(
                            currentTaskId,
                            document.getElementById('crawlerProgress'),
                            document.querySelector('#crawlerProgress .progress-bar'),
                            document.getElementById('crawlerStatus'),
                            (result) => {
                                if (result.success) {
                                    showCrawlerResults(result);
                                    showAlert('Crawling completed successfully!', 'success');
                                } else {
                                    showAlert('Crawling failed: ' + result.error, 'danger');
                                }
                                document.getElementById('startCrawlBtn').disabled = false;
                            }
                        );
                    }, 1000);
                } else {
                    showAlert('Failed to start crawling: ' + data.error, 'danger');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('Error starting crawling process', 'danger');
            });
        });

        // Scrapper form submission
        document.getElementById('scrapperForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                team_id: document.getElementById('scrapeTeamId').value,
                user_id: document.getElementById('userId').value,
                additional_input: document.getElementById('scrapeAdditionalUrls').value,
                skip_existing_urls: document.getElementById('skipExistingUrls').checked,
                iterative: document.getElementById('iterative').checked,
                processing_mode: document.getElementById('processingMode').value
            };

            fetch('/api/scrape', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentTaskId = data.task_id;
                    document.getElementById('scrapeProgress').style.display = 'block';
                    document.getElementById('startScrapeBtn').disabled = true;
                    
                    taskCheckInterval = setInterval(() => {
                        checkTaskStatus(
                            currentTaskId,
                            document.getElementById('scrapeProgress'),
                            document.querySelector('#scrapeProgress .progress-bar'),
                            document.getElementById('scrapeStatus'),
                            (result) => {
                                if (result.success) {
                                    showScrapeResults(result);
                                    showAlert('Scraping completed successfully!', 'success');
                                } else {
                                    showAlert('Scraping failed: ' + result.error, 'danger');
                                }
                                document.getElementById('startScrapeBtn').disabled = false;
                            }
                        );
                    }, 1000);
                } else {
                    showAlert('Failed to start scraping: ' + data.error, 'danger');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('Error starting scraping process', 'danger');
            });
        });

        // Get URLs button
        document.getElementById('getUrlsBtn').addEventListener('click', function() {
            const teamId = document.getElementById('dataTeamId').value;
            if (!teamId) {
                showAlert('Please enter a Team ID', 'warning');
                return;
            }

            fetch(`/api/urls/${teamId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('urlsSection').style.display = 'block';
                        document.getElementById('urlsContent').textContent = data.content;
                        showAlert(`Retrieved ${data.url_count} URLs from file`, 'success');
                    } else {
                        showAlert(data.error, 'warning');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showAlert('Error retrieving URLs', 'danger');
                });
        });

        // Get Data button
        document.getElementById('getDataBtn').addEventListener('click', function() {
            const teamId = document.getElementById('dataTeamId').value;
            if (!teamId) {
                showAlert('Please enter a Team ID', 'warning');
                return;
            }

            fetch(`/api/data/${teamId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('dataSection').style.display = 'block';
                        document.getElementById('dataContent').textContent = JSON.stringify(data.data, null, 2);
                        showAlert(`Retrieved ${data.data.total_items} knowledge items`, 'success');
                    } else {
                        showAlert(data.error, 'warning');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showAlert('Error retrieving data', 'danger');
                });
        });

        // Download buttons
        document.getElementById('downloadUrlsBtn').addEventListener('click', function() {
            const teamId = document.getElementById('teamId').value;
            if (teamId) {
                window.open(`/api/download/${teamId}`, '_blank');
            }
        });

        document.getElementById('downloadUrlsDataBtn').addEventListener('click', function() {
            const teamId = document.getElementById('dataTeamId').value;
            if (teamId) {
                window.open(`/api/download/${teamId}`, '_blank');
            }
        });

        // Refresh button
        document.getElementById('refreshUrlsBtn').addEventListener('click', function() {
            const teamId = document.getElementById('teamId').value;
            if (teamId) {
                fetch(`/api/urls/${teamId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            document.getElementById('urlFileContent').textContent = data.content;
                            showAlert('URL file refreshed', 'success');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showAlert('Error refreshing URLs', 'danger');
                    });
            }
        });

        // Results display functions
        function showCrawlerResults(result) {
            const metrics = result.summary;
            const metricsHtml = `
                <div class="col-md-4">
                    <div class="metric-card">
                        <div class="metric-value">${metrics.total_unique_urls || 0}</div>
                        <div class="metric-label">Total URLs</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-card">
                        <div class="metric-value">${metrics.company_pages || 0}</div>
                        <div class="metric-label">Company Pages</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-card">
                        <div class="metric-value">${metrics.blog_posts || 0}</div>
                        <div class="metric-label">Blog Posts</div>
                    </div>
                </div>
            `;
            document.getElementById('crawlerMetrics').innerHTML = metricsHtml;
            document.getElementById('crawlerResults').style.display = 'block';
            
            // Load URL file content
            const teamId = document.getElementById('teamId').value;
            fetch(`/api/urls/${teamId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('urlFileContent').textContent = data.content;
                    }
                });
        }

        function showScrapeResults(result) {
            const stats = result.statistics;
            const metricsHtml = `
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value">${stats.urls_processed || 0}</div>
                        <div class="metric-label">URLs Processed</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value">${stats.knowledge_items_saved || 0}</div>
                        <div class="metric-label">Knowledge Items</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value">${stats.iterations_completed || 0}</div>
                        <div class="metric-label">Iterations</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value">${stats.total_new_links_found || 0}</div>
                        <div class="metric-label">New Links</div>
                    </div>
                </div>
            `;
            document.getElementById('scrapeMetrics').innerHTML = metricsHtml;
            document.getElementById('scrapeResults').style.display = 'block';
        }

        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
</body>
</html> 